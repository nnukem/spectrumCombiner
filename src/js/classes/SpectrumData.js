export default class SpectrumData{
  constructor(data){
      this._data = this.normalize(this.alignSpd(data || []))
      this._array = this._toArray()
  }

  getParameters(){
    let calcArray = this._toArray2()
    let xy = this._calcXY(calcArray)
    let cct = this._calcCCT(xy[0],xy[1])
    let duv = this._calcDUV(xy[0],xy[1])
    let cri = this._calcCRI(calcArray)
    let ra = 0
    for (const [i,c] of cri.entries()) {
      if(i==8) break;
       ra += c 
    }

    let params = {
      'xy':xy,
      'cct':cct,
      'duv':duv,
      'cri':cri,
      'ra': ra/8
    }
    return params
  }

  normalize(spd){
    let max = 0
    let obj = typeof spd[0] === 'object'
   
    if(obj){
      for (let pt of spd) {
        max = Math.max(max, pt.y)
      }
      if(max > 0){
        for (var k = 0; k < spd.length;k++) {
          spd[k].y = spd[k].y / max;
        }
      }
    }else{
      max = Math.max(...spd);
      if(max > 0){
        for (var k = 0; k < spd.length;k++) {
          spd[k] = spd[k] / max;
        }
      }
    }

    return spd
  }

  alignSpd(spdtoAlign){
    if (spdtoAlign.length == 0) return spdtoAlign
    if (spdtoAlign[0].x > 380) spdtoAlign[0].x = 380
    if (spdtoAlign[spdtoAlign.length - 1].x < 780) spdtoAlign.push({ x: 780, y: 0 })

    let spdAligned = []
    let lambda = 380
    for (let i = 0; i <= 400; i++) {
        spdAligned.push({ x: lambda, y: this._getYatX(spdtoAlign, lambda) })
        lambda += 1
    }

    return spdAligned
  }

  get array(){ return this._array }
  set array(array){
    if(array.length != 401) throw new Error('You have to provide array of peaks from 380nm to 780nm (401 elements)')
    this._data = []
    let lambda = 380
    for(let i  of array){
      this._data.push({ x: lambda, y: i })
      lambda += 1
    }

    this._data = this.normalize(this._data)
    this._array = this._toArray()
  }

  get data(){ return this._data }
  set data(data){
    if(typeof data == 'string') {
    }else if( typeof data == 'array'){
        this._data = this.normalize(this.alignSpd(data))
        this._array = this._toArray()
    }
  }

  toString(){
    return JSON.stringify(this._data)
  }

  _toArray(){
    let arr = []
    for( let p of this._data){
        arr.push(p.y);
    }

    return arr
  }

  _getYatX (spd, x) {
    let prev
    let next
    for (let pt of spd) {
      if (pt.x == x) return pt.y
      if (pt.x > x) {
        next = pt
        break
      } else {
        prev = pt
      }
    }

    let xDist = next.x - prev.x
    let yDist = next.y - prev.y
    let coef = (x - prev.x) / xDist

    return yDist * coef + prev.y
  }

  _bb_spectrum(wavelength, CCT) {
    var wlm = wavelength * 1e-9;   /* Wavelength in meters */
    return (3.74183e-16 * Math.pow(wlm, -5.0)) / (Math.exp(1.4388e-2 / (wlm * CCT)) - 1.0);
  }           
  
  _d_spectrum(wavelength,x,y){
    let s0 = [63.4,63.64,63.879999999999995,64.11999999999999,64.35999999999999,64.6,64.84,65.08,65.32,65.55999999999999,65.8,68.7,71.6,74.5,77.4,80.3,83.2,86.1,89,91.9,94.8,95.8,96.8,97.8,98.8,99.8,100.8,101.8,102.8,103.8,104.8,104.9,105,105.1,105.2,105.3,105.42,105.54,105.66000000000001,105.78,105.9,104.99000000000001,104.08000000000001,103.16999999999999,102.25999999999999,101.35,100.44,99.53,98.61999999999999,97.71,96.8,98.50999999999999,100.22,101.92999999999999,103.63999999999999,105.35,107.05999999999999,108.76999999999998,110.48000000000002,112.19000000000001,113.9,115.07000000000001,116.24000000000001,117.41,118.58,119.75,120.92,122.09,123.25999999999999,124.42999999999999,125.6,125.58,125.55999999999999,125.54,125.52000000000001,125.5,125.5,125.5,125.5,125.5,125.5,125.08,124.66,124.24000000000001,123.82000000000001,123.4,122.97999999999999,122.56000000000002,122.14000000000001,121.72,121.3,121.3,121.3,121.3,121.3,121.3,121.3,121.3,121.3,121.3,121.3,120.52000000000001,119.74000000000001,118.96000000000001,118.17999999999999,117.4,116.62,115.84,115.05999999999999,114.28,113.5,113.46,113.42,113.38,113.34,113.3,113.25999999999999,113.21999999999998,113.17999999999999,113.13999999999999,113.1,112.87,112.63999999999999,112.41,112.17999999999999,111.95,111.72,111.49000000000001,111.25999999999999,111.03,110.8,110.37,109.94000000000001,109.51000000000002,109.08,108.65,108.22,107.79,107.35999999999999,106.92999999999999,106.5,106.72999999999999,106.96,107.19000000000001,107.42,107.65,107.88,108.11000000000001,108.34,108.57000000000001,108.8,108.54,108.28,108.02000000000001,107.75999999999999,107.5,107.05999999999999,106.62,106.17999999999999,105.74000000000001,105.3,105.21,105.11999999999998,105.03,104.93999999999998,104.85,104.75999999999999,104.66999999999999,104.58000000000001,104.49000000000001,104.4,104,103.6,103.2,102.8,102.4,101.92,101.44000000000001,100.96000000000001,100.47999999999999,100,99.6,99.2,98.8,98.4,98,97.6,97.2,96.8,96.4,96,95.91,95.82000000000001,95.72999999999999,95.64,95.55,95.46,95.36999999999999,95.28,95.19,95.1,94.5,93.89999999999999,93.29999999999998,92.7,92.1,91.5,90.89999999999999,90.29999999999998,89.7,89.1,89.24,89.38,89.52,89.66,89.8,89.94,90.08,90.22,90.36,90.5,90.47999999999999,90.46000000000001,90.44000000000001,90.42,90.4,90.38000000000001,90.36000000000001,90.34,90.32000000000001,90.3,90.10999999999999,89.91999999999999,89.72999999999999,89.53999999999999,89.35,89.16,88.97,88.78,88.59,88.4,87.96000000000001,87.52000000000001,87.08000000000001,86.64000000000001,86.2,85.76,85.32000000000001,84.88,84.44,84,84.11,84.22,84.33,84.44,84.55,84.66,84.77,84.88,84.99,85.1,84.78,84.46,84.14,83.82000000000001,83.5,83.17999999999999,82.86,82.54,82.22,81.9,81.97,82.04,82.11,82.17999999999999,82.25,82.32000000000001,82.39,82.46,82.53,82.6,82.83,83.05999999999999,83.28999999999999,83.52000000000001,83.75,83.97999999999999,84.21000000000001,84.44000000000001,84.67,84.9,84.54,84.17999999999999,83.82000000000001,83.46,83.1,82.74,82.38,82.02,81.66,81.3,80.96,80.61999999999999,80.28,79.94,79.6,78.05999999999999,76.52000000000001,74.97999999999999,73.44000000000001,71.9,72.14000000000001,72.38,72.62,72.85999999999999,73.1,73.34,73.58,73.82,74.05999999999999,74.3,74.50999999999999,74.72,74.92999999999999,75.14,75.35,75.55999999999999,75.77000000000001,75.97999999999999,76.19000000000001,76.4,75.09,73.78,72.47,71.16,69.85,68.53999999999999,67.22999999999999,65.91999999999999,64.60999999999999,63.3,64.14,64.97999999999999,65.82000000000001,66.66,67.5,68.34,69.17999999999999,70.02000000000001,70.86,71.7,72.22999999999999,72.76,73.28999999999999,73.82,74.35,74.88,75.41,75.94,76.47,77,75.82000000000001,74.64,73.46,72.28,71.1,69.91999999999999,68.74,67.56,66.38,65.2,63.45,61.7,59.95,58.2,56.45,54.7,52.95,51.2,49.45,47.7,49.790000000000006,51.88000000000001,53.970000000000006,56.06,58.15,60.239999999999995,62.33,64.41999999999999,66.50999999999999,68.6,68.24,67.88,67.52,67.16,66.8,66.44,66.08,65.72,65.36,65]
    let s1 = [38.5,38.15,37.8,37.45,37.1,36.75,36.4,36.05,35.7,35.35,35,35.839999999999996,36.68,37.52,38.36,39.2,40.040000000000006,40.88,41.72,42.56,43.4,43.69,43.98,44.27,44.56,44.85,45.14,45.43,45.71999999999999,46.01,46.3,46.059999999999995,45.81999999999999,45.58,45.339999999999996,45.1,44.86,44.620000000000005,44.379999999999995,44.14,43.9,43.22,42.54,41.86,41.18,40.5,39.82,39.14,38.46,37.78,37.1,37.06,37.02,36.98,36.94,36.9,36.86,36.82,36.78,36.74,36.7,36.620000000000005,36.54,36.46,36.379999999999995,36.3,36.22,36.14,36.059999999999995,35.98,35.9,35.57,35.239999999999995,34.910000000000004,34.58,34.25,33.92,33.589999999999996,33.260000000000005,32.93,32.6,32.13,31.660000000000004,31.189999999999998,30.72,30.25,29.78,29.310000000000002,28.839999999999996,28.369999999999997,27.9,27.54,27.179999999999996,26.820000000000004,26.46,26.1,25.740000000000002,25.380000000000003,25.020000000000003,24.660000000000004,24.3,23.880000000000003,23.46,23.04,22.619999999999997,22.2,21.78,21.36,20.94,20.520000000000003,20.1,19.71,19.32,18.93,18.54,18.15,17.759999999999998,17.369999999999997,16.979999999999997,16.589999999999996,16.2,15.9,15.6,15.3,15,14.7,14.4,14.1,13.8,13.5,13.2,12.739999999999998,12.279999999999998,11.82,11.36,10.9,10.440000000000001,9.98,9.52,9.059999999999999,8.6,8.35,8.1,7.85,7.6,7.35,7.1,6.85,6.6,6.35,6.1,5.909999999999999,5.72,5.529999999999999,5.340000000000001,5.15,4.96,4.7700000000000005,4.58,4.390000000000001,4.2,3.97,3.7400000000000007,3.5099999999999993,3.28,3.05,2.82,2.59,2.36,2.13,1.9,1.7099999999999997,1.52,1.3299999999999998,1.14,0.95,0.76,0.57,0.38,0.19,0,-0.16,-0.32,-0.4800000000000001,-0.64,-0.8,-0.9600000000000002,-1.12,-1.28,-1.44,-1.6,-1.7899999999999998,-1.98,-2.17,-2.36,-2.55,-2.7399999999999998,-2.9299999999999997,-3.12,-3.31,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.5,-3.7299999999999995,-3.96,-4.19,-4.42,-4.65,-4.880000000000001,-5.11,-5.34,-5.57,-5.8,-5.85,-5.9,-5.95,-6,-6.05,-6.279999999999999,-6.51,-6.74,-6.970000000000001,-7.2,-7.340000000000001,-7.480000000000001,-7.62,-7.760000000000001,-7.9,-8.040000000000001,-8.180000000000001,-8.319999999999999,-8.459999999999999,-8.6,-8.690000000000001,-8.78,-8.870000000000001,-8.96,-9.05,-9.14,-9.23,-9.32,-9.41,-9.5,-9.64,-9.78,-9.919999999999998,-10.059999999999999,-10.2,-10.34,-10.48,-10.620000000000001,-10.76,-10.9,-10.88,-10.860000000000001,-10.84,-10.82,-10.8,-10.780000000000001,-10.760000000000002,-10.739999999999998,-10.719999999999999,-10.7,-10.83,-10.959999999999999,-11.09,-11.219999999999999,-11.35,-11.48,-11.61,-11.74,-11.870000000000001,-12,-12.2,-12.4,-12.6,-12.8,-13,-13.2,-13.4,-13.6,-13.8,-14,-13.959999999999999,-13.919999999999998,-13.88,-13.84,-13.8,-13.76,-13.720000000000002,-13.680000000000001,-13.64,-13.6,-13.440000000000001,-13.280000000000001,-13.120000000000001,-12.959999999999999,-12.8,-12.64,-12.48,-12.32,-12.16,-12,-12.129999999999999,-12.26,-12.39,-12.52,-12.65,-12.780000000000001,-12.910000000000002,-13.040000000000001,-13.170000000000002,-13.3,-13.26,-13.220000000000002,-13.180000000000001,-13.14,-13.1,-13.059999999999999,-13.02,-12.98,-12.940000000000001,-12.9,-12.67,-12.440000000000001,-12.209999999999999,-11.98,-11.75,-11.52,-11.290000000000001,-11.059999999999999,-10.83,-10.6,-10.7,-10.8,-10.9,-11,-11.1,-11.2,-11.3,-11.4,-11.5,-11.6,-11.66,-11.719999999999999,-11.780000000000001,-11.84,-11.9,-11.959999999999999,-12.02,-12.079999999999998,-12.139999999999999,-12.2,-12,-11.799999999999999,-11.599999999999998,-11.4,-11.2,-11,-10.799999999999999,-10.6,-10.4,-10.2,-9.959999999999999,-9.719999999999999,-9.48,-9.24,-9,-8.76,-8.52,-8.28,-8.040000000000001,-7.8,-8.14,-8.48,-8.82,-9.16,-9.5,-9.84,-10.18,-10.52,-10.86,-11.2,-11.12,-11.04,-10.96,-10.88,-10.8,-10.72,-10.64,-10.56,-10.48,-10.4]
    let s2 = [3,2.82,2.6399999999999997,2.46,2.2800000000000002,2.1,1.92,1.7400000000000002,1.56,1.3800000000000001,1.2,0.97,0.74,0.51,0.27999999999999997,0.05,-0.18000000000000002,-0.41000000000000003,-0.64,-0.8700000000000001,-1.1,-0.9800000000000001,-0.8600000000000001,-0.74,-0.62,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.52,-0.54,-0.5599999999999999,-0.58,-0.6,-0.6199999999999999,-0.6399999999999999,-0.6599999999999999,-0.6799999999999999,-0.7,-0.75,-0.7999999999999999,-0.85,-0.9,-0.95,-1,-1.05,-1.1,-1.15,-1.2,-1.35,-1.5,-1.65,-1.8,-1.95,-2.08,-2.21,-2.3400000000000003,-2.4699999999999998,-2.6,-2.63,-2.66,-2.69,-2.7199999999999998,-2.75,-2.7800000000000002,-2.81,-2.84,-2.87,-2.9,-2.8899999999999997,-2.88,-2.87,-2.8600000000000003,-2.85,-2.84,-2.83,-2.8199999999999994,-2.8099999999999996,-2.8,-2.78,-2.76,-2.74,-2.72,-2.7,-2.68,-2.66,-2.64,-2.62,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.6,-2.5200000000000005,-2.4400000000000004,-2.3600000000000003,-2.2800000000000002,-2.2,-2.12,-2.04,-1.9600000000000002,-1.8800000000000001,-1.8,-1.7719999999999998,-1.7440000000000002,-1.716,-1.688,-1.66,-1.6280000000000001,-1.5959999999999999,-1.564,-1.532,-1.5,-1.48,-1.46,-1.44,-1.42,-1.4,-1.38,-1.3599999999999999,-1.34,-1.3199999999999998,-1.3,-1.29,-1.28,-1.27,-1.26,-1.25,-1.24,-1.23,-1.22,-1.21,-1.2,-1.1800000000000002,-1.16,-1.1400000000000001,-1.12,-1.1,-1.08,-1.06,-1.04,-1.02,-1,-0.95,-0.9,-0.85,-0.8,-0.75,-0.7,-0.65,-0.6,-0.55,-0.5,-0.45999999999999996,-0.42000000000000004,-0.38,-0.33999999999999997,-0.3,-0.3,-0.3,-0.3,-0.3,-0.3,-0.26999999999999996,-0.24,-0.20999999999999996,-0.18,-0.15,-0.12,-0.09,-0.06,-0.03,0,0.02,0.04,0.06000000000000001,0.08,0.1,0.12000000000000002,0.14,0.16,0.18,0.2,0.22000000000000003,0.24000000000000005,0.25999999999999995,0.27999999999999997,0.3,0.33999999999999997,0.38,0.42000000000000004,0.45999999999999996,0.5,0.6599999999999999,0.82,0.9800000000000001,1.1400000000000001,1.3,1.4600000000000002,1.6200000000000003,1.78,1.9400000000000002,2.1,2.21,2.3200000000000003,2.4299999999999997,2.54,2.65,2.7600000000000002,2.87,2.9800000000000004,3.0900000000000003,3.2,3.29,3.3800000000000003,3.47,3.56,3.65,3.7399999999999998,3.8299999999999996,3.9199999999999995,4.01,4.1,4.159999999999999,4.220000000000001,4.279999999999999,4.340000000000001,4.4,4.46,4.5200000000000005,4.58,4.640000000000001,4.7,4.74,4.78,4.82,4.86,4.9,4.94,4.9799999999999995,5.0200000000000005,5.06,5.1,5.26,5.42,5.58,5.74,5.9,6.0600000000000005,6.220000000000001,6.380000000000001,6.540000000000001,6.7,6.76,6.82,6.88,6.94,7,7.06,7.12,7.18,7.24,7.3,7.44,7.58,7.720000000000001,7.859999999999999,8,8.120000000000001,8.24,8.36,8.48,8.6,8.719999999999999,8.84,8.959999999999999,9.08,9.2,9.319999999999999,9.440000000000001,9.559999999999999,9.680000000000001,9.8,9.84,9.88,9.92,9.959999999999999,10,10.040000000000001,10.08,10.12,10.16,10.2,10.01,9.819999999999999,9.629999999999999,9.440000000000001,9.25,9.059999999999999,8.870000000000001,8.680000000000001,8.49,8.3,8.430000000000001,8.559999999999999,8.690000000000001,8.819999999999999,8.95,9.08,9.209999999999999,9.34,9.469999999999999,9.6,9.495999999999999,9.392,9.288,9.184000000000001,9.08,8.964,8.848,8.732,8.616,8.5,8.35,8.2,8.05,7.9,7.75,7.6,7.45,7.3,7.15,7,7.06,7.12,7.18,7.24,7.3,7.359999999999999,7.419999999999999,7.4799999999999995,7.539999999999999,7.6,7.639999999999999,7.68,7.719999999999999,7.76,7.8,7.840000000000001,7.88,7.92,7.959999999999999,8,7.87,7.74,7.609999999999999,7.4799999999999995,7.35,7.220000000000001,7.089999999999999,6.959999999999999,6.83,6.7,6.55,6.4,6.25,6.1,5.95,5.8,5.65,5.5,5.35,5.2,5.42,5.640000000000001,5.859999999999999,6.08,6.3,6.5200000000000005,6.74,6.960000000000001,7.18,7.4,7.340000000000001,7.280000000000001,7.219999999999999,7.159999999999999,7.1,7.039999999999999,6.9799999999999995,6.919999999999999,6.859999999999999,6.8]
    
    let m = 0.0241+0.2562*x-0.7341*y
    let m1 = (-1.3515-1.7703*x+5.9114*y)/m
    let m2 = (0.03-31.4424*x+30.0717*y)/m

    let i = wavelength - 380

    return s0[i] + s1[i]*m1 + s2[i]*m2
  }

  _calcCRI(test) {
    var TCS =   [
                  [0.2190,0.2270,0.2350,0.2416,0.2468,0.2520,0.2536,0.2552,0.2560,0.2560,0.2560,0.2552,0.2544,0.2536,0.2528,0.2520,0.2504,0.2488,0.2472,0.2456,0.2440,0.2424,0.2408,0.2394,0.2382,0.2370,0.2350,0.2330,0.2316,0.2308,0.2300,0.2284,0.2268,0.2258,0.2254,0.2250,0.2238,0.2226,0.2216,0.2208,0.2200,0.2192,0.2184,0.2176,0.2168,0.2160,0.2152,0.2144,0.2140,0.2140,0.2140,0.2140,0.2140,0.2144,0.2152,0.2160,0.2168,0.2176,0.2190,0.2210,0.2230,0.2238,0.2246,0.2252,0.2256,0.2260,0.2260,0.2260,0.2258,0.2254,0.2250,0.2250,0.2250,0.2254,0.2262,0.2270,0.2282,0.2294,0.2312,0.2336,0.2360,0.2396,0.2432,0.2466,0.2498,0.2530,0.2566,0.2602,0.2640,0.2680,0.2720,0.2764,0.2808,0.2860,0.2920,0.2980,0.3060,0.3140,0.3226,0.3318,0.3410,0.3514,0.3618,0.3716,0.3808,0.3900,0.3976,0.4052,0.4120,0.4180,0.4240,0.4284,0.4328,0.4364,0.4392,0.4420,0.4444,0.4468,0.4484,0.4492,0.4500,0.4504,0.4508,0.4510,0.4510,0.4510,0.4510,0.4510,0.4510,0.4510,0.4510,0.4510,0.4510,0.4508,0.4504,0.4500,0.4500,0.4500,0.4502,0.4506,0.4510,0.4510,0.4510,0.4514,0.4522,0.4530,0.4534,0.4538,0.4542,0.4546,0.4550,0.4558,0.4566,0.4572,0.4576,0.4580,0.4588,0.4596,0.4604,0.4612,0.4620,0.4624,0.4628,0.4632,0.4636,0.4640,0.4644,0.4648,0.4652,0.4656,0.4660,0.4660,0.4660,0.4660,0.4660,0.4660,0.4660,0.4660,0.4662,0.4666,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670,0.4670],
                  [0.0700,0.0736,0.0772,0.0810,0.0850,0.0890,0.0938,0.0986,0.1030,0.1070,0.1110,0.1130,0.1150,0.1164,0.1172,0.1180,0.1188,0.1196,0.1202,0.1206,0.1210,0.1214,0.1218,0.1220,0.1220,0.1220,0.1220,0.1220,0.1222,0.1226,0.1230,0.1234,0.1238,0.1246,0.1258,0.1270,0.1274,0.1278,0.1286,0.1298,0.1310,0.1322,0.1334,0.1348,0.1364,0.1380,0.1400,0.1420,0.1444,0.1472,0.1500,0.1536,0.1572,0.1620,0.1680,0.1740,0.1804,0.1868,0.1934,0.2002,0.2070,0.2142,0.2214,0.2284,0.2352,0.2420,0.2464,0.2508,0.2544,0.2572,0.2600,0.2616,0.2632,0.2646,0.2658,0.2670,0.2678,0.2686,0.2696,0.2708,0.2720,0.2736,0.2752,0.2772,0.2796,0.2820,0.2848,0.2876,0.2910,0.2950,0.2990,0.3030,0.3070,0.3116,0.3168,0.3220,0.3248,0.3276,0.3302,0.3326,0.3350,0.3366,0.3382,0.3394,0.3402,0.3410,0.3410,0.3410,0.3412,0.3416,0.3420,0.3420,0.3420,0.3420,0.3420,0.3420,0.3416,0.3412,0.3410,0.3410,0.3410,0.3402,0.3394,0.3390,0.3390,0.3390,0.3386,0.3382,0.3380,0.3380,0.3380,0.3376,0.3372,0.3368,0.3364,0.3360,0.3356,0.3352,0.3348,0.3344,0.3340,0.3332,0.3324,0.3320,0.3320,0.3320,0.3316,0.3312,0.3310,0.3310,0.3310,0.3306,0.3302,0.3298,0.3294,0.3290,0.3286,0.3282,0.3280,0.3280,0.3280,0.3276,0.3272,0.3268,0.3264,0.3260,0.3256,0.3252,0.3248,0.3244,0.3240,0.3240,0.3240,0.3240,0.3240,0.3240,0.3236,0.3232,0.3228,0.3224,0.3220,0.3216,0.3212,0.3208,0.3204,0.3200,0.3192,0.3184,0.3176,0.3168,0.3160,0.3156,0.3152,0.3150,0.3150,0.3150,0.3146,0.3142,0.3140,0.3140,0.3140],
                  [0.0650,0.0662,0.0674,0.0684,0.0692,0.0700,0.0708,0.0716,0.0722,0.0726,0.0730,0.0730,0.0730,0.0732,0.0736,0.0740,0.0740,0.0740,0.0740,0.0740,0.0740,0.0736,0.0732,0.0730,0.0730,0.0730,0.0730,0.0730,0.0730,0.0730,0.0730,0.0730,0.0730,0.0732,0.0736,0.0740,0.0744,0.0748,0.0754,0.0762,0.0770,0.0782,0.0794,0.0810,0.0830,0.0850,0.0886,0.0922,0.0970,0.1030,0.1090,0.1158,0.1226,0.1304,0.1392,0.1480,0.1576,0.1672,0.1772,0.1876,0.1980,0.2072,0.2164,0.2250,0.2330,0.2410,0.2486,0.2562,0.2636,0.2708,0.2780,0.2876,0.2972,0.3094,0.3242,0.3390,0.3514,0.3638,0.3744,0.3832,0.3920,0.3948,0.3976,0.3992,0.3996,0.4000,0.3972,0.3944,0.3904,0.3852,0.3800,0.3740,0.3680,0.3618,0.3554,0.3490,0.3422,0.3354,0.3286,0.3218,0.3150,0.3086,0.3022,0.2962,0.2906,0.2850,0.2798,0.2746,0.2704,0.2672,0.2640,0.2612,0.2584,0.2560,0.2540,0.2520,0.2500,0.2480,0.2458,0.2434,0.2410,0.2386,0.2362,0.2338,0.2314,0.2290,0.2270,0.2250,0.2232,0.2216,0.2200,0.2188,0.2176,0.2168,0.2164,0.2160,0.2160,0.2160,0.2166,0.2178,0.2190,0.2210,0.2230,0.2252,0.2276,0.2300,0.2332,0.2364,0.2406,0.2458,0.2510,0.2582,0.2654,0.2728,0.2804,0.2880,0.2976,0.3072,0.3176,0.3288,0.3400,0.3504,0.3608,0.3708,0.3804,0.3900,0.3988,0.4076,0.4158,0.4234,0.4310,0.4374,0.4438,0.4496,0.4548,0.4600,0.4648,0.4696,0.4738,0.4774,0.4810,0.4838,0.4866,0.4890,0.4910,0.4930,0.4946,0.4962,0.4976,0.4988,0.5000,0.5008,0.5016,0.5026,0.5038,0.5050,0.5070,0.5090,0.5112,0.5136,0.5160],
                  [0.0740,0.0776,0.0812,0.0850,0.0890,0.0930,0.0978,0.1026,0.1072,0.1116,0.1160,0.1180,0.1200,0.1216,0.1228,0.1240,0.1248,0.1256,0.1264,0.1272,0.1280,0.1292,0.1304,0.1318,0.1334,0.1350,0.1366,0.1382,0.1400,0.1420,0.1440,0.1468,0.1496,0.1530,0.1570,0.1610,0.1654,0.1698,0.1748,0.1804,0.1860,0.1936,0.2012,0.2098,0.2194,0.2290,0.2390,0.2490,0.2594,0.2702,0.2810,0.2918,0.3026,0.3128,0.3224,0.3320,0.3400,0.3480,0.3556,0.3628,0.3700,0.3752,0.3804,0.3844,0.3872,0.3900,0.3916,0.3932,0.3942,0.3946,0.3950,0.3938,0.3926,0.3906,0.3878,0.3850,0.3818,0.3786,0.3750,0.3710,0.3670,0.3618,0.3566,0.3514,0.3462,0.3410,0.3354,0.3298,0.3240,0.3180,0.3120,0.3056,0.2992,0.2928,0.2864,0.2800,0.2732,0.2664,0.2598,0.2534,0.2470,0.2398,0.2326,0.2260,0.2200,0.2140,0.2076,0.2012,0.1954,0.1902,0.1850,0.1810,0.1770,0.1738,0.1714,0.1690,0.1670,0.1650,0.1632,0.1616,0.1600,0.1584,0.1568,0.1556,0.1548,0.1540,0.1532,0.1524,0.1518,0.1514,0.1510,0.1502,0.1494,0.1488,0.1484,0.1480,0.1480,0.1480,0.1480,0.1480,0.1480,0.1484,0.1488,0.1494,0.1502,0.1510,0.1522,0.1534,0.1548,0.1564,0.1580,0.1596,0.1612,0.1626,0.1638,0.1650,0.1662,0.1674,0.1684,0.1692,0.1700,0.1704,0.1708,0.1708,0.1704,0.1700,0.1692,0.1684,0.1676,0.1668,0.1660,0.1652,0.1644,0.1640,0.1640,0.1640,0.1644,0.1648,0.1656,0.1668,0.1680,0.1696,0.1712,0.1730,0.1750,0.1770,0.1786,0.1802,0.1818,0.1834,0.1850,0.1866,0.1882,0.1896,0.1908,0.1920,0.1928,0.1936,0.1946,0.1958,0.1970],
                  [0.2950,0.2994,0.3038,0.3068,0.3084,0.3100,0.3108,0.3116,0.3122,0.3126,0.3130,0.3138,0.3146,0.3158,0.3174,0.3190,0.3202,0.3214,0.3228,0.3244,0.3260,0.3276,0.3292,0.3308,0.3324,0.3340,0.3360,0.3380,0.3404,0.3432,0.3460,0.3484,0.3508,0.3536,0.3568,0.3600,0.3636,0.3672,0.3714,0.3762,0.3810,0.3862,0.3914,0.3958,0.3994,0.4030,0.4058,0.4086,0.4110,0.4130,0.4150,0.4162,0.4174,0.4182,0.4186,0.4190,0.4182,0.4174,0.4162,0.4146,0.4130,0.4114,0.4098,0.4078,0.4054,0.4030,0.4002,0.3974,0.3946,0.3918,0.3890,0.3858,0.3826,0.3792,0.3756,0.3720,0.3684,0.3648,0.3610,0.3570,0.3530,0.3486,0.3442,0.3398,0.3354,0.3310,0.3266,0.3222,0.3176,0.3128,0.3080,0.3040,0.3000,0.2952,0.2896,0.2840,0.2788,0.2736,0.2688,0.2644,0.2600,0.2548,0.2496,0.2440,0.2380,0.2320,0.2272,0.2224,0.2180,0.2140,0.2100,0.2060,0.2020,0.1988,0.1964,0.1940,0.1920,0.1900,0.1882,0.1866,0.1850,0.1842,0.1834,0.1824,0.1812,0.1800,0.1788,0.1776,0.1768,0.1764,0.1760,0.1756,0.1752,0.1750,0.1750,0.1750,0.1750,0.1750,0.1750,0.1750,0.1750,0.1758,0.1766,0.1776,0.1788,0.1800,0.1812,0.1824,0.1836,0.1848,0.1860,0.1872,0.1884,0.1896,0.1908,0.1920,0.1932,0.1944,0.1958,0.1974,0.1990,0.1994,0.1998,0.1998,0.1994,0.1990,0.1986,0.1982,0.1976,0.1968,0.1960,0.1956,0.1952,0.1950,0.1950,0.1950,0.1954,0.1958,0.1962,0.1966,0.1970,0.1982,0.1994,0.2006,0.2018,0.2030,0.2038,0.2046,0.2056,0.2068,0.2080,0.2096,0.2112,0.2126,0.2138,0.2150,0.2158,0.2166,0.2174,0.2182,0.2190],
                  [0.1510,0.1718,0.1926,0.2154,0.2402,0.2650,0.2946,0.3242,0.3532,0.3816,0.4100,0.4316,0.4532,0.4696,0.4808,0.4920,0.4984,0.5048,0.5098,0.5134,0.5170,0.5198,0.5226,0.5254,0.5282,0.5310,0.5338,0.5366,0.5392,0.5416,0.5440,0.5468,0.5496,0.5520,0.5540,0.5560,0.5560,0.5560,0.5556,0.5548,0.5540,0.5520,0.5500,0.5474,0.5442,0.5410,0.5370,0.5330,0.5286,0.5238,0.5190,0.5130,0.5070,0.5008,0.4944,0.4880,0.4804,0.4728,0.4652,0.4576,0.4500,0.4424,0.4348,0.4276,0.4208,0.4140,0.4064,0.3988,0.3914,0.3842,0.3770,0.3694,0.3618,0.3546,0.3478,0.3410,0.3346,0.3282,0.3218,0.3154,0.3090,0.3026,0.2962,0.2902,0.2846,0.2790,0.2734,0.2678,0.2626,0.2578,0.2530,0.2482,0.2434,0.2396,0.2368,0.2340,0.2312,0.2284,0.2266,0.2258,0.2250,0.2238,0.2226,0.2218,0.2214,0.2210,0.2206,0.2202,0.2200,0.2200,0.2200,0.2200,0.2200,0.2200,0.2200,0.2200,0.2200,0.2200,0.2206,0.2218,0.2230,0.2246,0.2262,0.2282,0.2306,0.2330,0.2354,0.2378,0.2400,0.2420,0.2440,0.2468,0.2496,0.2524,0.2552,0.2580,0.2600,0.2620,0.2640,0.2660,0.2680,0.2700,0.2720,0.2740,0.2760,0.2780,0.2792,0.2804,0.2814,0.2822,0.2830,0.2842,0.2854,0.2870,0.2890,0.2910,0.2930,0.2950,0.2972,0.2996,0.3020,0.3064,0.3108,0.3154,0.3202,0.3250,0.3302,0.3354,0.3406,0.3458,0.3510,0.3562,0.3614,0.3664,0.3712,0.3760,0.3812,0.3864,0.3914,0.3962,0.4010,0.4058,0.4106,0.4154,0.4202,0.4250,0.4294,0.4338,0.4382,0.4426,0.4470,0.4514,0.4558,0.4602,0.4646,0.4690,0.4722,0.4754,0.4786,0.4818,0.4850],
                  [0.3780,0.4104,0.4428,0.4720,0.4980,0.5240,0.5328,0.5416,0.5470,0.5490,0.5510,0.5526,0.5542,0.5558,0.5574,0.5590,0.5594,0.5598,0.5602,0.5606,0.5610,0.5598,0.5586,0.5576,0.5568,0.5560,0.5540,0.5520,0.5496,0.5468,0.5440,0.5404,0.5368,0.5324,0.5272,0.5220,0.5156,0.5092,0.5024,0.4952,0.4880,0.4804,0.4728,0.4648,0.4564,0.4480,0.4404,0.4328,0.4248,0.4164,0.4080,0.3988,0.3896,0.3806,0.3718,0.3630,0.3542,0.3454,0.3376,0.3308,0.3240,0.3188,0.3136,0.3090,0.3050,0.3010,0.2970,0.2930,0.2894,0.2862,0.2830,0.2790,0.2750,0.2714,0.2682,0.2650,0.2630,0.2610,0.2594,0.2582,0.2570,0.2570,0.2570,0.2574,0.2582,0.2590,0.2594,0.2598,0.2600,0.2600,0.2600,0.2592,0.2584,0.2576,0.2568,0.2560,0.2552,0.2544,0.2540,0.2540,0.2540,0.2560,0.2580,0.2612,0.2656,0.2700,0.2756,0.2812,0.2876,0.2948,0.3020,0.3108,0.3196,0.3280,0.3360,0.3440,0.3512,0.3584,0.3650,0.3710,0.3770,0.3818,0.3866,0.3912,0.3956,0.4000,0.4040,0.4080,0.4120,0.4160,0.4200,0.4236,0.4272,0.4308,0.4344,0.4380,0.4408,0.4436,0.4464,0.4492,0.4520,0.4540,0.4560,0.4580,0.4600,0.4620,0.4636,0.4652,0.4664,0.4672,0.4680,0.4688,0.4696,0.4706,0.4718,0.4730,0.4746,0.4762,0.4782,0.4806,0.4830,0.4854,0.4878,0.4904,0.4932,0.4960,0.4988,0.5016,0.5046,0.5078,0.5110,0.5138,0.5166,0.5194,0.5222,0.5250,0.5278,0.5306,0.5334,0.5362,0.5390,0.5426,0.5462,0.5490,0.5510,0.5530,0.5554,0.5578,0.5602,0.5626,0.5650,0.5670,0.5690,0.5710,0.5730,0.5750,0.5762,0.5774,0.5786,0.5798,0.5810],
                  [0.1040,0.1140,0.1240,0.1372,0.1536,0.1700,0.1980,0.2260,0.2558,0.2874,0.3190,0.3578,0.3966,0.4252,0.4436,0.4620,0.4700,0.4780,0.4836,0.4868,0.4900,0.4892,0.4884,0.4868,0.4844,0.4820,0.4784,0.4748,0.4708,0.4664,0.4620,0.4572,0.4524,0.4478,0.4434,0.4390,0.4338,0.4286,0.4234,0.4182,0.4130,0.4066,0.4002,0.3940,0.3880,0.3820,0.3756,0.3692,0.3632,0.3576,0.3520,0.3460,0.3400,0.3346,0.3298,0.3250,0.3190,0.3130,0.3078,0.3034,0.2990,0.2950,0.2910,0.2878,0.2854,0.2830,0.2802,0.2774,0.2748,0.2724,0.2700,0.2668,0.2636,0.2608,0.2584,0.2560,0.2540,0.2520,0.2508,0.2504,0.2500,0.2504,0.2508,0.2516,0.2528,0.2540,0.2556,0.2572,0.2592,0.2616,0.2640,0.2660,0.2680,0.2696,0.2708,0.2720,0.2728,0.2736,0.2748,0.2764,0.2780,0.2804,0.2828,0.2862,0.2906,0.2950,0.3034,0.3118,0.3224,0.3352,0.3480,0.3624,0.3768,0.3940,0.4140,0.4340,0.4532,0.4724,0.4912,0.5096,0.5280,0.5440,0.5600,0.5752,0.5896,0.6040,0.6140,0.6240,0.6328,0.6404,0.6480,0.6540,0.6600,0.6656,0.6708,0.6760,0.6796,0.6832,0.6866,0.6898,0.6930,0.6958,0.6986,0.7010,0.7030,0.7050,0.7066,0.7082,0.7096,0.7108,0.7120,0.7132,0.7144,0.7154,0.7162,0.7170,0.7178,0.7186,0.7194,0.7202,0.7210,0.7206,0.7202,0.7198,0.7194,0.7190,0.7202,0.7214,0.7226,0.7238,0.7250,0.7258,0.7266,0.7274,0.7282,0.7290,0.7294,0.7298,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300,0.7300],
                  [0.0660,0.0644,0.0628,0.0612,0.0596,0.0580,0.0568,0.0556,0.0544,0.0532,0.0520,0.0520,0.0520,0.0518,0.0514,0.0510,0.0506,0.0502,0.0500,0.0500,0.0500,0.0496,0.0492,0.0488,0.0484,0.0480,0.0476,0.0472,0.0468,0.0464,0.0460,0.0452,0.0444,0.0436,0.0428,0.0420,0.0416,0.0412,0.0404,0.0392,0.0380,0.0368,0.0356,0.0346,0.0338,0.0330,0.0322,0.0314,0.0308,0.0304,0.0300,0.0296,0.0292,0.0288,0.0284,0.0280,0.0280,0.0280,0.0280,0.0280,0.0280,0.0284,0.0288,0.0292,0.0296,0.0300,0.0300,0.0300,0.0302,0.0306,0.0310,0.0310,0.0310,0.0312,0.0316,0.0320,0.0320,0.0320,0.0322,0.0326,0.0330,0.0334,0.0338,0.0342,0.0346,0.0350,0.0358,0.0366,0.0378,0.0394,0.0410,0.0422,0.0434,0.0448,0.0464,0.0480,0.0496,0.0512,0.0536,0.0568,0.0600,0.0664,0.0728,0.0812,0.0916,0.1020,0.1156,0.1292,0.1468,0.1684,0.1900,0.2164,0.2428,0.2720,0.3040,0.3360,0.3688,0.4016,0.4354,0.4702,0.5050,0.5354,0.5658,0.5930,0.6170,0.6410,0.6574,0.6738,0.6890,0.7030,0.7170,0.7262,0.7354,0.7436,0.7508,0.7580,0.7628,0.7676,0.7722,0.7766,0.7810,0.7846,0.7882,0.7914,0.7942,0.7970,0.7994,0.8018,0.8042,0.8066,0.8090,0.8110,0.8130,0.8150,0.8170,0.8190,0.8210,0.8230,0.8248,0.8264,0.8280,0.8288,0.8296,0.8302,0.8306,0.8310,0.8318,0.8326,0.8334,0.8342,0.8350,0.8354,0.8358,0.8360,0.8360,0.8360,0.8364,0.8368,0.8372,0.8376,0.8380,0.8384,0.8388,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390,0.8390],
                  [0.0500,0.0516,0.0532,0.0550,0.0570,0.0590,0.0606,0.0622,0.0636,0.0648,0.0660,0.0664,0.0668,0.0672,0.0676,0.0680,0.0684,0.0688,0.0690,0.0690,0.0690,0.0694,0.0698,0.0704,0.0712,0.0720,0.0724,0.0728,0.0736,0.0748,0.0760,0.0768,0.0776,0.0790,0.0810,0.0830,0.0850,0.0870,0.0894,0.0922,0.0950,0.0982,0.1014,0.1050,0.1090,0.1130,0.1178,0.1226,0.1284,0.1352,0.1420,0.1500,0.1580,0.1674,0.1782,0.1890,0.2010,0.2130,0.2276,0.2448,0.2620,0.2792,0.2964,0.3170,0.3410,0.3650,0.3854,0.4058,0.4258,0.4454,0.4650,0.4826,0.5002,0.5164,0.5312,0.5460,0.5600,0.5740,0.5868,0.5984,0.6100,0.6196,0.6292,0.6378,0.6454,0.6530,0.6582,0.6634,0.6684,0.6732,0.6780,0.6816,0.6852,0.6882,0.6906,0.6930,0.6950,0.6970,0.6986,0.6998,0.7010,0.7022,0.7034,0.7042,0.7046,0.7050,0.7050,0.7050,0.7052,0.7056,0.7060,0.7064,0.7068,0.7070,0.7070,0.7070,0.7070,0.7070,0.7072,0.7076,0.7080,0.7080,0.7080,0.7084,0.7092,0.7100,0.7104,0.7108,0.7112,0.7116,0.7120,0.7128,0.7136,0.7144,0.7152,0.7160,0.7168,0.7176,0.7184,0.7192,0.7200,0.7208,0.7216,0.7226,0.7238,0.7250,0.7266,0.7282,0.7294,0.7302,0.7310,0.7326,0.7342,0.7358,0.7374,0.7390,0.7402,0.7414,0.7428,0.7444,0.7460,0.7468,0.7476,0.7482,0.7486,0.7490,0.7498,0.7506,0.7514,0.7522,0.7530,0.7534,0.7538,0.7542,0.7546,0.7550,0.7550,0.7550,0.7550,0.7550,0.7550,0.7550,0.7550,0.7556,0.7568,0.7580,0.7576,0.7572,0.7572,0.7576,0.7580,0.7584,0.7588,0.7590,0.7590,0.7590,0.7590,0.7590,0.7590,0.7590,0.7590],
                  [0.1110,0.1150,0.1190,0.1222,0.1246,0.1270,0.1278,0.1286,0.1286,0.1278,0.1270,0.1246,0.1222,0.1200,0.1180,0.1160,0.1144,0.1128,0.1112,0.1096,0.1080,0.1068,0.1056,0.1048,0.1044,0.1040,0.1040,0.1040,0.1042,0.1046,0.1050,0.1054,0.1058,0.1068,0.1084,0.1100,0.1120,0.1140,0.1166,0.1198,0.1230,0.1274,0.1318,0.1368,0.1424,0.1480,0.1556,0.1632,0.1720,0.1820,0.1920,0.2028,0.2136,0.2256,0.2388,0.2520,0.2676,0.2832,0.2978,0.3114,0.3250,0.3338,0.3426,0.3488,0.3524,0.3560,0.3548,0.3536,0.3516,0.3488,0.3460,0.3408,0.3356,0.3292,0.3216,0.3140,0.3060,0.2980,0.2894,0.2802,0.2710,0.2618,0.2526,0.2438,0.2354,0.2270,0.2186,0.2102,0.2024,0.1952,0.1880,0.1808,0.1736,0.1666,0.1598,0.1530,0.1470,0.1410,0.1354,0.1302,0.1250,0.1206,0.1162,0.1124,0.1092,0.1060,0.1036,0.1012,0.0992,0.0976,0.0960,0.0944,0.0928,0.0916,0.0908,0.0900,0.0888,0.0876,0.0866,0.0858,0.0850,0.0838,0.0826,0.0816,0.0808,0.0800,0.0796,0.0792,0.0788,0.0784,0.0780,0.0780,0.0780,0.0780,0.0780,0.0780,0.0780,0.0780,0.0786,0.0798,0.0810,0.0818,0.0826,0.0840,0.0860,0.0880,0.0900,0.0920,0.0948,0.0984,0.1020,0.1060,0.1100,0.1146,0.1198,0.1250,0.1314,0.1378,0.1450,0.1530,0.1610,0.1694,0.1778,0.1862,0.1946,0.2030,0.2110,0.2190,0.2268,0.2344,0.2420,0.2480,0.2540,0.2596,0.2648,0.2700,0.2748,0.2796,0.2840,0.2880,0.2920,0.2960,0.3000,0.3036,0.3068,0.3100,0.3116,0.3132,0.3146,0.3158,0.3170,0.3194,0.3218,0.3244,0.3272,0.3300,0.3316,0.3332,0.3348,0.3364,0.3380],
                  [0.1200,0.1132,0.1064,0.1004,0.0952,0.0900,0.0868,0.0836,0.0808,0.0784,0.0760,0.0728,0.0696,0.0672,0.0656,0.0640,0.0644,0.0648,0.0670,0.0710,0.0750,0.0822,0.0894,0.0990,0.1110,0.1230,0.1378,0.1526,0.1694,0.1882,0.2070,0.2266,0.2462,0.2648,0.2824,0.3000,0.3124,0.3248,0.3340,0.3400,0.3460,0.3464,0.3468,0.3458,0.3434,0.3410,0.3358,0.3306,0.3238,0.3154,0.3070,0.2970,0.2870,0.2770,0.2670,0.2570,0.2462,0.2354,0.2248,0.2144,0.2040,0.1936,0.1832,0.1732,0.1636,0.1540,0.1440,0.1340,0.1250,0.1170,0.1090,0.1014,0.0938,0.0870,0.0810,0.0750,0.0698,0.0646,0.0598,0.0554,0.0510,0.0470,0.0430,0.0398,0.0374,0.0350,0.0326,0.0302,0.0282,0.0266,0.0250,0.0238,0.0226,0.0214,0.0202,0.0190,0.0182,0.0174,0.0170,0.0170,0.0170,0.0170,0.0170,0.0168,0.0164,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0160,0.0164,0.0172,0.0180,0.0180,0.0180,0.0180,0.0180,0.0180,0.0180,0.0180,0.0182,0.0186,0.0190,0.0194,0.0198,0.0206,0.0218,0.0230,0.0234,0.0238,0.0244,0.0252,0.0260,0.0276,0.0292,0.0310,0.0330,0.0350,0.0382,0.0414,0.0456,0.0508,0.0560,0.0632,0.0704,0.0786,0.0878,0.0970,0.1094,0.1218,0.1360,0.1520,0.1680,0.1848,0.2016,0.2194,0.2382,0.2570,0.2762,0.2954,0.3148,0.3344,0.3540,0.3728,0.3916,0.4100,0.4280,0.4460,0.4616,0.4772,0.4920,0.5060,0.5200,0.5324,0.5448,0.5562,0.5666,0.5770,0.5858,0.5946,0.6028,0.6104,0.6180,0.6240,0.6300,0.6354,0.6402,0.6450],
                  [0.1040,0.1132,0.1224,0.1338,0.1474,0.1610,0.1810,0.2010,0.2216,0.2428,0.2640,0.2836,0.3032,0.3186,0.3298,0.3410,0.3454,0.3498,0.3534,0.3562,0.3590,0.3598,0.3606,0.3616,0.3628,0.3640,0.3644,0.3648,0.3654,0.3662,0.3670,0.3678,0.3686,0.3696,0.3708,0.3720,0.3728,0.3736,0.3744,0.3752,0.3760,0.3772,0.3784,0.3800,0.3820,0.3840,0.3860,0.3880,0.3906,0.3938,0.3970,0.4002,0.4034,0.4072,0.4116,0.4160,0.4212,0.4264,0.4318,0.4374,0.4430,0.4474,0.4518,0.4554,0.4582,0.4610,0.4630,0.4650,0.4666,0.4678,0.4690,0.4698,0.4706,0.4716,0.4728,0.4740,0.4748,0.4756,0.4774,0.4802,0.4830,0.4858,0.4886,0.4932,0.4996,0.5060,0.5140,0.5220,0.5314,0.5422,0.5530,0.5646,0.5762,0.5892,0.6036,0.6180,0.6312,0.6444,0.6568,0.6684,0.6800,0.6884,0.6968,0.7042,0.7106,0.7170,0.7218,0.7266,0.7304,0.7332,0.7360,0.7384,0.7408,0.7426,0.7438,0.7450,0.7458,0.7466,0.7472,0.7476,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7480,0.7478,0.7474,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7466,0.7462,0.7460,0.7460,0.7460,0.7460,0.7460,0.7458,0.7454,0.7450,0.7446,0.7442,0.7438,0.7434,0.7430,0.7434,0.7438,0.7442,0.7446,0.7450,0.7462,0.7474,0.7484,0.7492,0.7500,0.7500,0.7500,0.7498,0.7494,0.7490,0.7486,0.7482,0.7480,0.7480,0.7480,0.7476,0.7472,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470,0.7470],
                  [0.0360,0.0360,0.0360,0.0362,0.0366,0.0370,0.0374,0.0378,0.0382,0.0386,0.0390,0.0390,0.0390,0.0392,0.0396,0.0400,0.0404,0.0408,0.0412,0.0416,0.0420,0.0420,0.0420,0.0422,0.0426,0.0430,0.0434,0.0438,0.0440,0.0440,0.0440,0.0444,0.0448,0.0450,0.0450,0.0450,0.0454,0.0458,0.0462,0.0466,0.0470,0.0474,0.0478,0.0484,0.0492,0.0500,0.0508,0.0516,0.0526,0.0538,0.0550,0.0558,0.0566,0.0580,0.0600,0.0620,0.0640,0.0660,0.0686,0.0718,0.0750,0.0782,0.0814,0.0848,0.0884,0.0920,0.0952,0.0984,0.1016,0.1048,0.1080,0.1132,0.1184,0.1234,0.1282,0.1330,0.1366,0.1402,0.1436,0.1468,0.1500,0.1516,0.1532,0.1542,0.1546,0.1550,0.1538,0.1526,0.1510,0.1490,0.1470,0.1442,0.1414,0.1386,0.1358,0.1330,0.1298,0.1266,0.1236,0.1208,0.1180,0.1156,0.1132,0.1108,0.1084,0.1060,0.1040,0.1020,0.1004,0.0992,0.0980,0.0968,0.0956,0.0946,0.0938,0.0930,0.0918,0.0906,0.0898,0.0894,0.0890,0.0882,0.0874,0.0868,0.0864,0.0860,0.0856,0.0852,0.0848,0.0844,0.0840,0.0840,0.0840,0.0840,0.0840,0.0840,0.0840,0.0840,0.0842,0.0846,0.0850,0.0858,0.0866,0.0880,0.0900,0.0920,0.0936,0.0952,0.0972,0.0996,0.1020,0.1052,0.1084,0.1126,0.1178,0.1230,0.1286,0.1342,0.1400,0.1460,0.1520,0.1588,0.1656,0.1728,0.1804,0.1880,0.1956,0.2032,0.2108,0.2184,0.2260,0.2328,0.2396,0.2464,0.2532,0.2600,0.2668,0.2736,0.2804,0.2872,0.2940,0.3004,0.3068,0.3130,0.3190,0.3250,0.3306,0.3362,0.3418,0.3474,0.3530,0.3582,0.3634,0.3686,0.3738,0.3790,0.3834,0.3878,0.3918,0.3954,0.3990],
                  [0.1310,0.1476,0.1426,0.1378,0.1411,0.1470,0.1506,0.1523,0.1538,0.1559,0.1580,0.1599,0.1614,0.1625,0.1632,0.1640,0.1651,0.1664,0.1676,0.1687,0.1700,0.1717,0.1738,0.1762,0.1789,0.1820,0.1857,0.1898,0.1942,0.1988,0.2030,0.2068,0.2103,0.2138,0.2174,0.2210,0.2244,0.2275,0.2304,0.2332,0.2360,0.2388,0.2416,0.2443,0.2468,0.2490,0.2511,0.2530,0.2550,0.2570,0.2590,0.2610,0.2630,0.2649,0.2669,0.2690,0.2716,0.2745,0.2776,0.2808,0.2840,0.2870,0.2897,0.2922,0.2943,0.2960,0.2972,0.2979,0.2980,0.2974,0.2960,0.2936,0.2905,0.2875,0.2847,0.2820,0.2793,0.2770,0.2752,0.2743,0.2740,0.2743,0.2753,0.2769,0.2789,0.2810,0.2829,0.2849,0.2872,0.2896,0.2910,0.2908,0.2896,0.2885,0.2875,0.2860,0.2835,0.2809,0.2795,0.2804,0.2850,0.2942,0.3068,0.3215,0.3373,0.3540,0.3713,0.3891,0.4069,0.4243,0.4400,0.4533,0.4647,0.4752,0.4851,0.4940,0.5016,0.5081,0.5138,0.5191,0.5240,0.5286,0.5330,0.5369,0.5406,0.5440,0.5473,0.5505,0.5535,0.5563,0.5590,0.5614,0.5638,0.5662,0.5687,0.5710,0.5731,0.5750,0.5770,0.5790,0.5810,0.5831,0.5851,0.5869,0.5885,0.5900,0.5915,0.5931,0.5950,0.5970,0.5990,0.6008,0.6023,0.6036,0.6047,0.6060,0.6076,0.6093,0.6106,0.6114,0.6120,0.6127,0.6135,0.6145,0.6154,0.6160,0.6162,0.6161,0.6160,0.6160,0.6160,0.6161,0.6160,0.6159,0.6156,0.6150,0.6142,0.6133,0.6128,0.6124,0.6120,0.6112,0.6104,0.6097,0.6093,0.6090,0.6086,0.6081,0.6079,0.6077,0.6070,0.6058,0.6058,0.6092,0.6129,0.6090,0.5955,0.5957,0.6359,0.6764,0.6110],
                ];
    var reference=[];
    var xyc = this._calcXY(test);
    var testCCT = this._calcCCT(xyc[0],xyc[1]);
    for (var i = 0;i<=200;i++)
    {
      if(testCCT >= 5000){
        reference[i]= this._d_spectrum(i*2+380,xyc[0],xyc[1]);
      }else{
        reference[i]= this._bb_spectrum(i*2+380,testCCT);
      }
        
    }
    reference = this.normalize(reference);

    console.log(">>>",reference.toString().replace(/,/g,"\n"))
    
    var refXYZ = this._calcXYZ(reference);
    var testXYZ = this._calcXYZ(test);
    
    var refNorm = 100 / refXYZ[1];
    refXYZ[0] = refXYZ[0] * refNorm;
    refXYZ[1] = refXYZ[1] * refNorm;
    refXYZ[2] = refXYZ[2] * refNorm;
    
    var testNorm = 100 / testXYZ[1];
    testXYZ[0] = testXYZ[0] * refNorm;
    testXYZ[1] = testXYZ[1] * refNorm;
    testXYZ[2] = testXYZ[2] * refNorm;
    
    var refTCSXYZ =[];
    var testTCSXYZ = [];
    for (var t = 0; t<15;t++)
    {
        var refRefl = [];
        var testRefl = [];
        for (var k = 0;k<201;k++)
        {
                refRefl[k] = reference[k] * TCS[t][k];
                testRefl[k] = test[k] * TCS[t][k];     
        }
        refTCSXYZ[t] = this._calcXYZ(refRefl);
        testTCSXYZ[t] = this._calcXYZ(testRefl);
    }

    //normalize the XYZ values based on original
    for (var q = 0; q<15;q++)
    {
        refTCSXYZ[q][0] = refTCSXYZ[q][0] * refNorm;
        refTCSXYZ[q][1] = refTCSXYZ[q][1] * refNorm;
        refTCSXYZ[q][2] = refTCSXYZ[q][2] * refNorm;
        
        testTCSXYZ[q][0] = testTCSXYZ[q][0] * testNorm;
        testTCSXYZ[q][1] = testTCSXYZ[q][1] * testNorm;
        testTCSXYZ[q][2] = testTCSXYZ[q][2] * testNorm;
        
    }

    var XYref = this._calcXYZ(reference);
    var XYtest = this._calcXYZ(test);
    
    //u and v coordinates for reference and test in 1960
    var uref = 4*XYref[0] / (XYref[0] + 15 * XYref[1] +3 * XYref[2]);
    var vref = 6*XYref[1] / (XYref[0] + 15 * XYref[1] +3 * XYref[2]);
    var utest = 4*XYtest[0] / (XYtest[0] + 15 * XYtest[1] +3 * XYtest[2]);
    var vtest = 6*XYtest[1] / (XYtest[0] + 15 * XYtest[1] +3 * XYtest[2]);
    
    var DC = Math.sqrt(Math.pow(uref - utest,2)+Math.pow(vref - vtest,2));
    //c and d constants for use in Von Kries
    var cref = (4 - uref - 10* vref) / vref;
    var dref = (1.708 * vref - 1.481 *uref + 0.404) / vref;
    var ctest = (4 - utest - 10* vtest) / vtest;
    var dtest = (1.708 * vtest - 1.481 *utest + 0.404) / vtest;
    
    //u and v coordinates for each TCS in 1960
    var urefTCS =[];
    var vrefTCS =[];
    var utestTCS =[];
    var vtestTCS =[]; 
    
    //c and d constants for TCS samples for use in Von Kries
    var crefTCS =[];
    var drefTCS =[];
    var ctestTCS =[];
    var dtestTCS =[];
    
    var vku = [];
    var vkv = [];
    
    var Wref = [];
    var Uref = [];
    var Vref = [];
    
    var Wtest = [];
    var Utest = [];
    var Vtest = [];
    
    var Euc = [];
    var Ri = [];
    for (var s =0;s<15;s++)
    {
      if(DC > 0.0054) {
        Ri[s]=0;
      }else{
         urefTCS[s] = 4*refTCSXYZ[s][0] / (refTCSXYZ[s][0] + 15 * refTCSXYZ[s][1] +3 * refTCSXYZ[s][2]);
         vrefTCS[s] = 6*refTCSXYZ[s][1] / (refTCSXYZ[s][0] + 15 * refTCSXYZ[s][1] +3 * refTCSXYZ[s][2]);
         utestTCS[s] = 4*testTCSXYZ[s][0] / (testTCSXYZ[s][0] + 15 * testTCSXYZ[s][1] +3 * testTCSXYZ[s][2]);
         vtestTCS[s] = 6*testTCSXYZ[s][1] / (testTCSXYZ[s][0] + 15 * testTCSXYZ[s][1] +3 * testTCSXYZ[s][2]);

         crefTCS[s] = (4 - urefTCS[s] - 10* vrefTCS[s]) / vrefTCS[s];
         drefTCS[s] = (1.708 * vrefTCS[s] - 1.481 *urefTCS[s] + 0.404) / vrefTCS[s];
         ctestTCS[s] = (4 - utestTCS[s] - 10* vtestTCS[s]) / vtestTCS[s];
         dtestTCS[s] = (1.708 * vtestTCS[s] - 1.481 *utestTCS[s] + 0.404) / vtestTCS[s];
         
         vku[s] = (10.872 + 0.404 * (cref / ctest) *ctestTCS[s] - 4 * (dref / dtest) * dtestTCS[s]) / (16.518 + 1.481 * (cref / ctest) * ctestTCS[s] - (dref/dtest) * dtestTCS[s]);
         vkv[s] = 5.52 / (16.518+1.481*(cref / ctest)*ctestTCS[s] - (dref/dtest)*dtestTCS[s]);
         
         Wref[s] = 25* Math.pow(refTCSXYZ[s][1],1/3) - 17;
         Uref[s] = 13 * Wref[s] * (urefTCS[s] - uref);
         Vref[s] = 13 * Wref[s] * (vrefTCS[s] - vref);
         
         Wtest[s] = 25* Math.pow(testTCSXYZ[s][1],1/3) - 17;
         Utest[s] = 13 * Wtest[s] * (vku[s] - uref);
         Vtest[s] = 13 * Wtest[s] * (vkv[s] - vref);
  
         Euc[s] = Math.sqrt(Math.pow(Wref[s] - Wtest[s],2)+Math.pow(Uref[s] - Utest[s],2)+Math.pow(Vref[s] - Vtest[s],2));
         Ri[s] = 100 - 4.6 * Euc[s];
      }
    }

    
    return Ri;
  }

  _calcCCT(x,y) {
    //McCamy's approximation
    var n = (x-0.3320)/(y-0.1858); 
    return (-449*Math.pow(n,3) + 3525*Math.pow(n,2) - 6823*n + 5520.33);
  }

  _calcDUV(x,y) {
    var u = (4*x) / (-2*x + 12*y + 3);
    var v = (6*y) / (-2*x + 12*y + 3);
    
    var k6 =-0.00616793;
    var k5 =0.0893944;
    var k4 =-0.5179722;
    var k3 =1.5317403;
    var k2 =-2.4243787;
    var k1 =1.925865;
    var k0 =-0.471106;
    var Lfp = Math.sqrt(Math.pow((u - 0.292),2)+Math.pow((v-0.24),2));
    var a = Math.acos((u-0.292)/Lfp);
    var Lbb = k6*Math.pow(a,6) + k5*Math.pow(a,5) + k4*Math.pow(a,4) + k3*Math.pow(a,3) + k2*Math.pow(a,2) + k1*a+k0;
    return Lfp - Lbb;
  }

  _calcXYZ(spd) {
    var x = [0.00136800000,0.00164232800,0.00199575700,0.00253538500,0.00330082900,0.00424300000,0.00533004800,0.00674111700,0.00875137300,0.01142170000,0.01431000000,0.01714744000,0.02074801000,0.02620736000,0.03388092000,0.04351000000,0.05502260000,0.06921200000,0.08695811000,0.10840630000,0.13438000000,0.16539570000,0.19861100000,0.23018680000,0.25877730000,0.28390000000,0.30489650000,0.32164540000,0.33435130000,0.34312130000,0.34828000000,0.35014740000,0.34928700000,0.34637330000,0.34180880000,0.33620000000,0.33004110000,0.32288680000,0.31402510000,0.30329040000,0.29080000000,0.27672140000,0.26042270000,0.24084750000,0.21840720000,0.19536000000,0.17332730000,0.15228330000,0.13217860000,0.11327520000,0.09564000000,0.07930804000,0.06458099000,0.05186211000,0.04115088000,0.03201000000,0.02414440000,0.01754040000,0.01216179000,0.00796724000,0.00490000000,0.00294532000,0.00223629300,0.00292552000,0.00517484000,0.00930000000,0.01553588000,0.02399277000,0.03481485000,0.04798504000,0.06327000000,0.08046224000,0.09945645000,0.12016740000,0.14236790000,0.16550000000,0.18914000000,0.21336580000,0.23832090000,0.26399220000,0.29040000000,0.31757260000,0.34548280000,0.37408390000,0.40337840000,0.43344990000,0.46433600000,0.49597130000,0.52829590000,0.56120940000,0.59450000000,0.62797580000,0.66156970000,0.69523920000,0.72882840000,0.76210000000,0.79482560000,0.82682480000,0.85793250000,0.88789440000,0.91630000000,0.94279840000,0.96721790000,0.98938560000,1.00908920000,1.02630000000,1.04098600000,1.05246670000,1.05979440000,1.06280680000,1.06220000000,1.05844360000,1.05097680000,1.03903690000,1.02266620000,1.00260000000,0.97933140000,0.95284790000,0.92319400000,0.89050200000,0.85444990000,0.81494600000,0.77295400000,0.72958360000,0.68560220000,0.64240000000,0.60111380000,0.56139770000,0.52259950000,0.48474360000,0.44790000000,0.41209800000,0.37753330000,0.34445630000,0.31301920000,0.28350000000,0.25611840000,0.23072720000,0.20709710000,0.18517080000,0.16490000000,0.14623000000,0.12914670000,0.11363970000,0.09969044000,0.08740000000,0.07680428000,0.06768664000,0.05980685000,0.05297104000,0.04677000000,0.04087536000,0.03540461000,0.03056419000,0.02634484000,0.02270000000,0.01959988000,0.01698717000,0.01479064000,0.01294868000,0.01135916000,0.00993884600,0.00867885400,0.00758238800,0.00662731300,0.00579034600,0.00505258300,0.00440350700,0.00383391300,0.00333434200,0.00289932700,0.00252302000,0.00219661600,0.00191096000,0.00166011000,0.00143997100,0.00124627500,0.00107643000,0.00092873580,0.00080075030,0.00069007860,0.00059450210,0.00051242900,0.00044245360,0.00038298140,0.00033230110,0.00028888710,0.00025156820,0.00021917100,0.00019084050,0.00016615050,0.00014462190,0.00012585200,0.00010955150,0.00009539445,0.00008307527,0.00007231304,0.00006292844,0.00005477028,0.00004767654,0.00004150994];
    var y = [0.00003900000,0.00004691460,0.00005717640,0.00007234421,0.00009350816,0.00012000000,0.00015149200,0.00019181600,0.00024690670,0.00031852000,0.00039600000,0.00047302400,0.00057221870,0.00072456000,0.00094116000,0.00121000000,0.00153075200,0.00193532300,0.00245480000,0.00311780000,0.00400000000,0.00515932000,0.00654616000,0.00808650700,0.00976768000,0.01160000000,0.01358272000,0.01571509000,0.01800736000,0.02045392000,0.02300000000,0.02561024000,0.02835125000,0.03131083000,0.03452112000,0.03800000000,0.04176800000,0.04584267000,0.05024368000,0.05498056000,0.06000000000,0.06527752000,0.07091109000,0.07701600000,0.08366680000,0.09098000000,0.09904584000,0.10788460000,0.11753200000,0.12799280000,0.13902000000,0.15046930000,0.16271770000,0.17624310000,0.19127350000,0.20802000000,0.22673450000,0.24748120000,0.27018490000,0.29505050000,0.32300000000,0.35468580000,0.38928750000,0.42562990000,0.46339440000,0.50300000000,0.54451200000,0.58696530000,0.62934560000,0.67087520000,0.71000000000,0.74546360000,0.77783680000,0.80811040000,0.83630680000,0.86200000000,0.88496240000,0.90544320000,0.92373480000,0.93992260000,0.95400000000,0.96600740000,0.97602250000,0.98409240000,0.99031280000,0.99495010000,0.99809830000,0.99974820000,0.99985670000,0.99832550000,0.99500000000,0.98974260000,0.98272410000,0.97408370000,0.96385680000,0.95200000000,0.93849920000,0.92345760000,0.90700640000,0.88920480000,0.87000000000,0.84939200000,0.82758130000,0.80479470000,0.78119200000,0.75700000000,0.73242240000,0.70749650000,0.68221920000,0.65667440000,0.63100000000,0.60531440000,0.57963790000,0.55396110000,0.52835280000,0.50300000000,0.47803040000,0.45340320000,0.42908000000,0.40503200000,0.38100000000,0.35682720000,0.33281760000,0.30933810000,0.28659360000,0.26500000000,0.24488960000,0.22605280000,0.20816160000,0.19115520000,0.17500000000,0.15964640000,0.14512590000,0.13150030000,0.11877920000,0.10700000000,0.09618864000,0.08626485000,0.07712064000,0.06871008000,0.06100000000,0.05395504000,0.04754965000,0.04175872000,0.03656384000,0.03200000000,0.02807664000,0.02470805000,0.02180077000,0.01928108000,0.01700000000,0.01483718000,0.01283478000,0.01106831000,0.00953331100,0.00821000000,0.00708542400,0.00613848500,0.00534305900,0.00467640400,0.00410200000,0.00358909900,0.00313409300,0.00273813900,0.00239324400,0.00209100000,0.00182458000,0.00159018700,0.00138449600,0.00120409200,0.00104700000,0.00091110880,0.00079323840,0.00069008270,0.00059949600,0.00052000000,0.00045005280,0.00038871840,0.00033538350,0.00028916560,0.00024920000,0.00021468560,0.00018504750,0.00015977810,0.00013830160,0.00012000000,0.00010432240,0.00009084587,0.00007914667,0.00006891600,0.00006000000,0.00005222560,0.00004544747,0.00003956104,0.00003444868,0.00003000000,0.00002611356,0.00002272461,0.00001977855,0.00001721687,0.00001499000];
    var z = [0.00645000100,0.00774548800,0.00941454400,0.01196580000,0.01558805000,0.02005001000,0.02520288000,0.03189704000,0.04143771000,0.05411988000,0.06785001000,0.08136156000,0.09854048000,0.12461330000,0.16130350000,0.20740000000,0.26261140000,0.33079850000,0.41620910000,0.51969480000,0.64560000000,0.79671330000,0.95943900000,1.11536730000,1.25812330000,1.38560000000,1.49480350000,1.58488070000,1.65640480000,1.70987450000,1.74706000000,1.76962330000,1.78043340000,1.78296820000,1.77919820000,1.77211000000,1.76403900000,1.75246630000,1.73355950000,1.70593690000,1.66920000000,1.62341270000,1.56452800000,1.48611140000,1.38987990000,1.28764000000,1.18782430000,1.09014800000,0.99419760000,0.90145310000,0.81295010000,0.72944480000,0.65210490000,0.58232860000,0.52033760000,0.46518000000,0.41618360000,0.37294590000,0.33485780000,0.30133750000,0.27200000000,0.24648380000,0.22345330000,0.20116920000,0.17922540000,0.15820000000,0.13837580000,0.12007510000,0.10390480000,0.08998272000,0.07824999000,0.06867816000,0.06078835000,0.05390435000,0.04775276000,0.04216000000,0.03693564000,0.03208872000,0.02771181000,0.02378716000,0.02030000000,0.01724036000,0.01458461000,0.01230723000,0.01037792000,0.00874999900,0.00738160000,0.00624280000,0.00530360000,0.00453420000,0.00390000000,0.00337060000,0.00293480000,0.00258520000,0.00230940000,0.00210000000,0.00194820000,0.00184093300,0.00176626700,0.00171120000,0.00165000100,0.00156440000,0.00145853300,0.00133666700,0.00120500000,0.00110000000,0.00104940000,0.00102120000,0.00096864000,0.00088688000,0.00080000000,0.00072368000,0.00064544000,0.00054786670,0.00043540000,0.00034000000,0.00028316000,0.00025181330,0.00022954670,0.00021196000,0.00019000000,0.00015564000,0.00011685330,0.00008613333,0.00006500000,0.00004999999,0.00003948000,0.00003264000,0.00002765333,0.00002364000,0.00002000000,0.00001620000,0.00001213333,0.00000773333,0.00000320000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000,0.00000000000];
    var XX = 0.0;
    var YY = 0.0;
    var ZZ = 0.0;

    for (let i=1;i<=200;i++) {
      XX = XX+spd[i]*x[i];
      YY = YY+spd[i]*y[i];
      ZZ = ZZ+spd[i]*z[i];
    }
    return([XX,YY,ZZ]);
  }

  _calcXY(spd) {
    let XYZ = this._calcXYZ(spd);
    return [XYZ[0]/(XYZ[0]+XYZ[1]+XYZ[2]),XYZ[1]/(XYZ[0]+XYZ[1]+XYZ[2])];
  }

  _toArray2(){
    let array2 = []
    for(let i =0;i<this._array.length;i+=2){
      array2.push(this._array[i])
    }

    return array2
  }

  static fromThereminoData(thereminoString){
    return new SpectrumData(SpectrumData._parseTheremino(thereminoString))
  }

  static _parseTheremino(thereminoString){
    thereminoString = thereminoString.replace('Nanometers', '').replace('Percentual', '').replace('-----------------------', '').replace(/ /g, '')
    let spdArray = thereminoString.split('\n')
    let spd = []
    let tmp, x, y
    for (let el of spdArray) {
      el = el.replace(/\s/g, '')
      if (el !== '') {
        tmp = el.split(';')
        x = parseFloat(tmp[0])
        y = parseFloat(tmp[1])
        if (x >= 380 && x <= 780) {
          spd.push({ x: x, y: y })
        }
      }
    }

    return spd
  }
}